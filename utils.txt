utility code for version three